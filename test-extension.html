<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base Encoder æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .test-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #005a87;
        }
        .result {
            background: #f9f9f9;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            word-break: break-all;
            min-height: 20px;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
        .test-case {
            border-left: 4px solid #007cba;
            padding-left: 15px;
            margin: 15px 0;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #007cba;
            border-bottom: 2px solid #007cba;
            padding-bottom: 5px;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #f2f2f2;
        }
        .popup-test {
            border: 2px solid #007cba;
            background: #e8f4f8;
        }
        .base-convert {
            border: 2px solid #28a745;
            background: #e8f5e8;
        }
        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .base-reference {
            margin-top: 15px;
            padding: 10px;
            background: #e9f7ef;
            border-radius: 4px;
            font-size: 14px;
        }
        .base-reference h4 {
            margin: 0 0 8px 0;
            color: #28a745;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Base Encoder Chrome æ“´å……åŠŸèƒ½æ¸¬è©¦</h1>
    
    <div class="test-container popup-test">
        <h2>ğŸ“± Base ç·¨ç¢¼/è§£ç¢¼æ¸¬è©¦</h2>
        <p>æ¸¬è©¦ Base64ã€Base58 ç·¨ç¢¼èˆ‡è§£ç¢¼åŠŸèƒ½ï¼š</p>
        
        <div class="mode-selection" style="margin-bottom: 15px; text-align: center;">
            <label style="display: inline-block; margin: 0 15px;">
                <input type="radio" name="test-mode" value="encode" checked>
                ç·¨ç¢¼
            </label>
            <label style="display: inline-block; margin: 0 15px;">
                <input type="radio" name="test-mode" value="decode">
                è§£ç¢¼
            </label>
        </div>
        
        <textarea id="popup-input" class="test-input" placeholder="è¼¸å…¥è¦è™•ç†çš„å…§å®¹" rows="3">Hello World</textarea>
        
        <div style="margin-bottom: 15px;">
            <label>é¸æ“‡æ ¼å¼:</label>
            <select id="popup-format" style="width: 100%; padding: 8px; margin-top: 5px;">
                <option value="base64">Base64</option>
                <option value="base58">Base58</option>
            </select>
        </div>
        
        <div style="text-align: center; margin: 15px 0;">
            <button id="popup-process" class="test-button">è™•ç†</button>
        </div>
        
        <div>
            <strong>çµæœï¼š</strong>
            <div id="popup-output" class="result" style="border: 1px solid #ddd;">é»æ“Šè™•ç†æŒ‰éˆ•é€²è¡Œç·¨ç¢¼/è§£ç¢¼</div>
        </div>
    </div>

    <div class="test-container base-convert">
        <h2>ğŸ”¢ é€²åˆ¶è½‰æ›æ¸¬è©¦</h2>
        <p>æ¸¬è©¦ 2ï½36 é€²åˆ¶ä¹‹é–“çš„æ•¸å­—è½‰æ›ï¼š</p>
        
        <div class="grid-container">
            <div>
                <label>ä¾†æºé€²åˆ¶ (2-36):</label>
                <input type="number" id="from-base" class="test-input" min="2" max="36" value="10" placeholder="è¼¸å…¥ä¾†æºé€²åˆ¶">
            </div>
            <div>
                <label>ç›®æ¨™é€²åˆ¶ (2-36):</label>
                <input type="number" id="to-base" class="test-input" min="2" max="36" value="16" placeholder="è¼¸å…¥ç›®æ¨™é€²åˆ¶">
            </div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <label>è¼¸å…¥æ•¸å­—æˆ–æ–‡å­—:</label>
            <input type="text" id="base-input" class="test-input" placeholder="è¼¸å…¥è¦è½‰æ›çš„æ•¸å­—æˆ–æ–‡å­—" value="255">
        </div>
        
        <div style="text-align: center; margin: 15px 0;">
            <button id="base-convert" class="test-button">è½‰æ›</button>
            <button id="base-clear" class="test-button" style="background: #6c757d;">æ¸…é™¤</button>
        </div>
        
        <div>
            <strong>è½‰æ›çµæœï¼š</strong>
            <div id="base-output" class="result" style="border: 1px solid #ddd;">é»æ“Šè½‰æ›æŒ‰éˆ•é€²è¡Œé€²åˆ¶è½‰æ›</div>
        </div>
        
        <div class="base-reference">
            <h4>å¸¸ç”¨é€²åˆ¶åƒè€ƒï¼š</h4>
            <p><strong>2é€²åˆ¶:</strong> 0,1 | <strong>8é€²åˆ¶:</strong> 0-7 | <strong>10é€²åˆ¶:</strong> 0-9 | <strong>16é€²åˆ¶:</strong> 0-9,A-F | <strong>36é€²åˆ¶:</strong> 0-9,A-Z</p>
        </div>
    </div>

    <div class="test-container">
        <h2>ğŸ§ª è‡ªå‹•åŒ–æ¸¬è©¦æ¡ˆä¾‹</h2>
        <button id="run-all-tests" class="test-button" style="background: #28a745;">åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦</button>
        <div id="test-results"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ“Š ç·¨ç¢¼çµæœæ¯”è¼ƒè¡¨</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>åŸå§‹æ–‡å­—</th>
                    <th>Base64</th>
                    <th>Base58</th>
                </tr>
            </thead>
            <tbody id="comparison-tbody">
                <!-- å‹•æ…‹å¡«å…… -->
            </tbody>
        </table>
    </div>

    <div class="test-container">
        <h2>ğŸ¯ äº’å‹•æ¸¬è©¦å€åŸŸ</h2>
        <input type="text" id="custom-input" class="test-input" placeholder="è¼¸å…¥è‡ªè¨‚æ–‡å­—é€²è¡Œæ¸¬è©¦" value="æ¸¬è©¦ä¸­æ–‡å­—ç¬¦">
        <button id="test-custom" class="test-button">æ¸¬è©¦è‡ªè¨‚è¼¸å…¥</button>
        <div id="custom-results"></div>
    </div>

    <script src="src/utils/encoders.js"></script>
    <script>
        // æ¸¬è©¦æ¡ˆä¾‹æ•¸æ“š (åŒ…å«ç·¨ç¢¼å’Œè§£ç¢¼)
        const testCases = [
            { input: "", expected: "ç©ºå­—ä¸²æ¸¬è©¦", mode: "encode" },
            { input: "A", expected: "å–®ä¸€å­—ç¬¦ç·¨ç¢¼", mode: "encode" },
            { input: "Hello", expected: "è‹±æ–‡å–®å­—ç·¨ç¢¼", mode: "encode" },
            { input: "Hello World", expected: "å«ç©ºæ ¼çš„è‹±æ–‡ç·¨ç¢¼", mode: "encode" },
            { input: "ä½ å¥½", expected: "ä¸­æ–‡å­—ç¬¦ç·¨ç¢¼", mode: "encode" },
            { input: "æ¸¬è©¦", expected: "ä¸­æ–‡å­—ç¬¦ç·¨ç¢¼2", mode: "encode" },
            { input: "Hello ä¸–ç•Œ", expected: "ä¸­è‹±æ··åˆç·¨ç¢¼", mode: "encode" },
            { input: "ğŸš€ Emoji æ¸¬è©¦", expected: "Emojiå­—ç¬¦ç·¨ç¢¼", mode: "encode" },
            { input: "SGVsbG8gV29ybGQ=", expected: "Base64è§£ç¢¼æ¸¬è©¦", mode: "decode", format: "base64" },
            { input: "5L2g5aW9", expected: "ä¸­æ–‡Base64è§£ç¢¼æ¸¬è©¦", mode: "decode", format: "base64" },
            { input: "JxF12TrwUP45BMd", expected: "Base58è§£ç¢¼æ¸¬è©¦", mode: "decode", format: "base58" }
        ];

        // æ¨¡æ“¬ popup åŠŸèƒ½
        function setupPopupSimulation() {
            const inputField = document.getElementById('popup-input');
            const outputField = document.getElementById('popup-output');
            const processButton = document.getElementById('popup-process');
            const formatSelect = document.getElementById('popup-format');
            const modeRadios = document.querySelectorAll('input[name="test-mode"]');

            // æ›´æ–°ä»‹é¢æ–‡å­—
            function updateInterface() {
                const selectedMode = document.querySelector('input[name="test-mode"]:checked').value;
                const isEncode = selectedMode === "encode";
                
                processButton.textContent = isEncode ? "ç·¨ç¢¼" : "è§£ç¢¼";
                inputField.placeholder = isEncode ? "è¼¸å…¥è¦ç·¨ç¢¼çš„å…§å®¹" : "è¼¸å…¥è¦è§£ç¢¼çš„å…§å®¹";
            }

            // ç›£è½æ¨¡å¼è®Šæ›´
            modeRadios.forEach(radio => {
                radio.addEventListener("change", updateInterface);
            });

            processButton.addEventListener('click', function() {
                const inputText = inputField.value.trim();
                const selectedFormat = formatSelect.value;
                const selectedMode = document.querySelector('input[name="test-mode"]:checked').value;
                
                if (inputText === '') {
                    outputField.textContent = '';
                    outputField.className = 'result';
                    return;
                }
                
                try {
                    let result;
                    
                    if (selectedMode === "encode") {
                        switch (selectedFormat) {
                            case "base64":
                                result = base64Encode(inputText);
                                break;
                            case "base58":
                                result = base58Encode(inputText);
                                break;
                        }
                    } else {
                        switch (selectedFormat) {
                            case "base64":
                                result = base64Decode(inputText);
                                break;
                            case "base58":
                                result = base58Decode(inputText);
                                break;
                        }
                    }
                    
                    outputField.textContent = result;
                    outputField.className = 'result success';
                } catch (error) {
                    outputField.textContent = 'éŒ¯èª¤: ' + error.message;
                    outputField.className = 'result error';
                }
            });

            // åˆå§‹åŒ–ä»‹é¢
            updateInterface();
        }

        // é€²åˆ¶è½‰æ›åŠŸèƒ½
        function setupBaseConversion() {
            const fromBaseInput = document.getElementById('from-base');
            const toBaseInput = document.getElementById('to-base');
            const baseInput = document.getElementById('base-input');
            const baseOutput = document.getElementById('base-output');
            const convertButton = document.getElementById('base-convert');
            const clearButton = document.getElementById('base-clear');

            // è½‰æ›å‡½æ•¸
            function convertBase() {
                const fromBase = parseInt(fromBaseInput.value);
                const toBase = parseInt(toBaseInput.value);
                const inputValue = baseInput.value.trim();

                if (!inputValue) {
                    baseOutput.textContent = 'è«‹è¼¸å…¥è¦è½‰æ›çš„æ•¸å€¼';
                    baseOutput.className = 'result error';
                    return;
                }

                if (isNaN(fromBase) || fromBase < 2 || fromBase > 36) {
                    baseOutput.textContent = 'ä¾†æºé€²åˆ¶å¿…é ˆåœ¨ 2-36 ä¹‹é–“';
                    baseOutput.className = 'result error';
                    return;
                }

                if (isNaN(toBase) || toBase < 2 || toBase > 36) {
                    baseOutput.textContent = 'ç›®æ¨™é€²åˆ¶å¿…é ˆåœ¨ 2-36 ä¹‹é–“';
                    baseOutput.className = 'result error';
                    return;
                }

                try {
                    let result;
                    
                    // æª¢æŸ¥è¼¸å…¥æ˜¯å¦ç‚ºç´”æ•¸å­—é€²åˆ¶è½‰æ›
                    const isValidBaseNumber = /^[0-9a-zA-Z]+$/.test(inputValue);
                    
                    if (isValidBaseNumber) {
                        // ç´”é€²åˆ¶è½‰æ›æ¨¡å¼
                        result = baseConvert(inputValue, fromBase, toBase);
                        
                        baseOutput.innerHTML = `
                            <strong>æ•¸å­—é€²åˆ¶è½‰æ›ï¼š</strong><br>
                            <strong>è¼¸å…¥:</strong> ${inputValue} (${fromBase}é€²åˆ¶)<br>
                            <strong>åé€²åˆ¶å€¼:</strong> ${parseInt(inputValue, fromBase)}<br>
                            <strong>çµæœ:</strong> ${result} (${toBase}é€²åˆ¶)
                        `;
                    } else {
                        // æ–‡å­—æ¨¡å¼ï¼šä½¿ç”¨å­—ç¬¦ç·¨ç¢¼
                        let encodedValues = [];
                        for (let i = 0; i < inputValue.length; i++) {
                            const charCode = inputValue.charCodeAt(i);
                            const converted = charCode.toString(toBase).toUpperCase();
                            encodedValues.push(converted);
                        }
                        result = encodedValues.join('-');
                        
                        baseOutput.innerHTML = `
                            <strong>æ–‡å­—é€²åˆ¶è½‰æ›ï¼š</strong><br>
                            <strong>è¼¸å…¥:</strong> "${inputValue}"<br>
                            <strong>è½‰æ›æ–¹å¼:</strong> å­—ç¬¦ç·¨ç¢¼ â†’ ${toBase}é€²åˆ¶<br>
                            <strong>çµæœ:</strong> ${result}<br>
                            <small>è¨»ï¼šæ¯å€‹å­—ç¬¦çš„Unicodeç·¨ç¢¼è½‰ç‚º${toBase}é€²åˆ¶ï¼Œç”¨ç ´æŠ˜è™Ÿåˆ†éš”</small>
                        `;
                    }
                    
                    baseOutput.className = 'result success';
                } catch (error) {
                    baseOutput.textContent = `è½‰æ›éŒ¯èª¤: ${error.message}`;
                    baseOutput.className = 'result error';
                }
            }

            // æ¸…é™¤å‡½æ•¸
            function clearAll() {
                baseInput.value = '';
                baseOutput.textContent = 'é»æ“Šè½‰æ›æŒ‰éˆ•é€²è¡Œé€²åˆ¶è½‰æ›';
                baseOutput.className = 'result';
                fromBaseInput.value = '10';
                toBaseInput.value = '16';
            }

            // äº‹ä»¶ç›£è½
            convertButton.addEventListener('click', convertBase);
            clearButton.addEventListener('click', clearAll);

            // Enter éµæ”¯æ´
            baseInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    convertBase();
                }
            });

            // å¿«é€Ÿè¨­ç½®å¸¸ç”¨é€²åˆ¶
            fromBaseInput.addEventListener('change', function() {
                const base = parseInt(this.value);
                if (base === 2) baseInput.placeholder = 'ä¾‹å¦‚: 1010101';
                else if (base === 8) baseInput.placeholder = 'ä¾‹å¦‚: 777';
                else if (base === 10) baseInput.placeholder = 'ä¾‹å¦‚: 255';
                else if (base === 16) baseInput.placeholder = 'ä¾‹å¦‚: FF';
                else baseInput.placeholder = 'è¼¸å…¥è¦è½‰æ›çš„æ•¸å­—æˆ–æ–‡å­—';
            });
        }

        // åŸ·è¡Œå–®ä¸€æ¸¬è©¦æ¡ˆä¾‹
        function runSingleTest(input, description, mode = "encode", format = "base64") {
            const results = {};
            let hasError = false;

            try {
                if (mode === "encode") {
                    results.base64 = base64Encode(input);
                    results.base58 = base58Encode(input);
                } else {
                    // è§£ç¢¼æ¨¡å¼ï¼Œåªæ¸¬è©¦æŒ‡å®šæ ¼å¼
                    switch (format) {
                        case "base64":
                            results.decoded = base64Decode(input);
                            break;
                        case "base58":
                            results.decoded = base58Decode(input);
                            break;
                    }
                }
            } catch (error) {
                results.error = `éŒ¯èª¤: ${error.message}`;
                hasError = true;
            }

            return { results, hasError, mode, format };
        }

        // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        function runAllTests() {
            const resultsDiv = document.getElementById('test-results');
            let html = '<h3>æ¸¬è©¦çµæœï¼š</h3>';
            let totalTests = 0;
            let passedTests = 0;

            testCases.forEach(testCase => {
                const mode = testCase.mode || "encode";
                const format = testCase.format || "base64";
                const { results, hasError } = runSingleTest(testCase.input, testCase.expected, mode, format);
                totalTests++;
                
                const status = hasError ? 'error' : 'success';
                const statusText = hasError ? 'âŒ å¤±æ•—' : 'âœ… é€šé';
                
                if (!hasError) passedTests++;

                html += `
                    <div class="test-case">
                        <h4>${testCase.expected} (${mode === 'encode' ? 'ç·¨ç¢¼' : 'è§£ç¢¼'}) <span class="${status}">${statusText}</span></h4>
                        <p><strong>è¼¸å…¥:</strong> "${testCase.input}"</p>
                `;
                
                if (mode === "encode") {
                    html += `
                        <p><strong>Base64:</strong> ${results.base64}</p>
                        <p><strong>Base58:</strong> ${results.base58}</p>
                    `;
                } else {
                    html += `
                        <p><strong>æ ¼å¼:</strong> ${format}</p>
                        <p><strong>è§£ç¢¼çµæœ:</strong> ${results.decoded || results.error}</p>
                    `;
                }
                
                html += `</div>`;
            });

            html += `
                <div style="background: #e9ecef; padding: 15px; border-radius: 4px; margin-top: 20px;">
                    <h3>æ¸¬è©¦ç¸½çµ</h3>
                    <p><strong>ç¸½æ¸¬è©¦æ•¸:</strong> ${totalTests}</p>
                    <p><strong>é€šéæ¸¬è©¦:</strong> ${passedTests}</p>
                    <p><strong>å¤±æ•—æ¸¬è©¦:</strong> ${totalTests - passedTests}</p>
                    <p><strong>é€šéç‡:</strong> ${((passedTests / totalTests) * 100).toFixed(1)}%</p>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        // å¡«å……æ¯”è¼ƒè¡¨
        function fillComparisonTable() {
            const tbody = document.getElementById('comparison-tbody');
            const sampleTexts = ['Hello', 'ä½ å¥½', 'æ¸¬è©¦', '123', 'A', 'Hello World', 'ğŸš€'];
            
            sampleTexts.forEach(text => {
                const { results } = runSingleTest(text, '', 'encode');
                const row = tbody.insertRow();
                row.insertCell(0).textContent = text;
                row.insertCell(1).textContent = results.base64;
                row.insertCell(2).textContent = results.base58;
            });
        }

        // è‡ªè¨‚æ¸¬è©¦åŠŸèƒ½
        function setupCustomTest() {
            document.getElementById('test-custom').addEventListener('click', function() {
                const input = document.getElementById('custom-input').value;
                const resultsDiv = document.getElementById('custom-results');
                
                // æ¸¬è©¦ç·¨ç¢¼
                const encodeResults = runSingleTest(input, 'è‡ªè¨‚ç·¨ç¢¼æ¸¬è©¦', 'encode');
                
                let html = `
                    <div class="test-case">
                        <h4>è‡ªè¨‚æ¸¬è©¦çµæœ</h4>
                        <p><strong>è¼¸å…¥:</strong> "${input}"</p>
                        <h5>ç·¨ç¢¼çµæœ:</h5>
                        <p><strong>Base64:</strong> ${encodeResults.results.base64}</p>
                        <p><strong>Base58:</strong> ${encodeResults.results.base58}</p>
                `;
                
                // å¦‚æœæœ‰ç·¨ç¢¼çµæœï¼Œå˜—è©¦è§£ç¢¼é©—è­‰
                if (!encodeResults.hasError && encodeResults.results.base64) {
                    try {
                        const decodeTest64 = base64Decode(encodeResults.results.base64);
                        const decodeTest58 = base58Decode(encodeResults.results.base58);
                        
                        html += `
                            <h5>è§£ç¢¼é©—è­‰ (æ‡‰è©²ç­‰æ–¼åŸå§‹è¼¸å…¥):</h5>
                            <p><strong>Base64 è§£ç¢¼:</strong> "${decodeTest64}" ${decodeTest64 === input ? 'âœ…' : 'âŒ'}</p>
                            <p><strong>Base58 è§£ç¢¼:</strong> "${decodeTest58}" ${decodeTest58 === input ? 'âœ…' : 'âŒ'}</p>
                        `;
                    } catch (error) {
                        html += `<p><strong>è§£ç¢¼é©—è­‰å¤±æ•—:</strong> ${error.message}</p>`;
                    }
                }
                
                html += `</div>`;
                resultsDiv.innerHTML = html;
            });
        }

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            setupPopupSimulation();
            setupBaseConversion();
            setupCustomTest();
            fillComparisonTable();
            
            document.getElementById('run-all-tests').addEventListener('click', runAllTests);
            
            console.log('Base Encoder æ¸¬è©¦é é¢å·²è¼‰å…¥å®Œæˆ');
            console.log('å¯ç”¨çš„ç·¨ç¢¼å‡½æ•¸:', {
                base64Encode: typeof base64Encode,
                base58Encode: typeof base58Encode,
                customBaseEncode: typeof customBaseEncode
            });
        });
    </script>
</body>
</html>
